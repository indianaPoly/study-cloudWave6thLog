ACL(보안 그룹), NAT (connected NAT Gateway)
ACL (Access Control List)
왜 필요한지? 접근할 수 있는 대상을 기록, 특정 트래픽을 분류 => 암호화, 네트워크 주소 변환 작업도 수행이 가능하다.

QoS : 실시간 트래픽에 대해서 대역폭을 보장 -> 트래픽을 골라내야하는데 이 과정에서 ACL이 사용이 된다.

IP를 기반으로 한 ACL, MAC 주소를 기반으로 한 ACL도 있긴 하지만 해당 내용들은 IP를 기반으로 한 ACL이다. (3계층 이상의 프로토콜들에 대해서 필터링이 가능하다.-> Extended Access List)


포트 번호는 TCP, UDP에서만 사용이 된다. ICMP는 포트 번호가 없다. 즉 확장 ACL 같은 경우에는 프로토콜에 따라서 입력되는 값이 바뀐다.


인바운드가 라우터 입장에서는 좋음. 아웃바운드의 경우에는 라우팅이 다되고 난 다음에 필터링을 진행한다. (추가적인 작업에 따른 비용이 발생)


100 | 출발지 192.168.0.0 /16 차단
200 | 출발지 192.168.1.0 /24 허용

=> 목적지가 192.168.1.100 => 차단

해당 ACL의 문제점은 넓은 범위에 부터 차단을 하는 문제가 있다. 따라서 위 순서를 수정 함으로 문제를 해결 할 수 있다.

마지막은 모든 트래픽을 차단
실습
>> VPC1에서 출발지가 172.16.0.0 /24 인터넷으로 가는 트픽을 차단, 나머지는 허용

access-list 1 deny 172.16.0.0 0.0.0.0.255

적용하는 기준에서 출발지에서 라우터로 들어올 때 해당 내용을 적용시켜버리면 인터넷으로 가는 트래픽 뿐만 아니라 모든 것을 다 차단해버리는 문제가 있음
(따라서 VPC1 Router에서는 인터페이스에서 GROUP으로 지정을 하고 방향 설정을 outBound로 설정)

>> 출발지가 172.16.1.0 /24에 해당하는 트래픽이 172.31.0.0 /24 네트워크로 전송되는 것을 차단

access-list 2 deny 172.16.1.0 /24 0.0.0.255
 
이를 정확하게 정의하기 위해서는 VPC2 들어가는 곳에다가 적용시키는 것이 제일 이상적이다.

>> 
172.16.0.0 /24 네트워크에서 172.31.1.250 서버로 가는 트래픽만 허용
172.16.0.0 /24 네트워크에서  172.31.1.0 /24 네트워크로 가는 모든 트래픽은 차단
그 외 모든 트래픽 모두 허용

access-list 100 permit ip 172.16.0.0 0.0.0.255 172.31.1.250 0.0.0.0
access-list 100 deny ip 172.16.0.0 0.0.0.255 172.31.1.0 0.0.0.255
access-list 100 permit ip any any

>>
172.16.1.0 /24 네트워크에서 172.31.0.150 서버의 웹서비스, FTP 서비스 허용
172.16.1.0 /24 네트워크에서 172.31.0.150 서버의 나머지 모든 트래픽 차단
그 외 트래픽 모두 허용

access-list 101 permit tcp 172.16.1.0 0.0.0.255 host 172.31.0.150 eq 80
access-list 101 permit tcp 172.16.1.0 0.0.0.255 host 172.31.0.150 eq 21 (session port)

access-list 101 deny ip 182.16.1.0 0.0.0.255 host 172.31.0.150

access-list 101 permit ip any any


Wildcard mask
간단하게 생각하면 서브넷 마스크의 반대. 서브넷 마스크보다 세밀하게 네트워크 표시가 가능하다.


192.168.1.100 /32 => 192.168.1.100 자체를 의미함.
>> 와일드카드 마스크에서는 0.0.0.0 이 됨.

192.168.1.100 => 네트워크 주소가 192.168.1.0 /24 를 의미함
NAT
외부로 부터 들어온 요청을 내부 서버에 전달 될 수 있도록 목적지 주소를 변환하는 기술


동적과 정적 라우팅 테이블의 목적이 다름


NAT를 설정을 하게 되면 출발할 때는 ip 값이 a 라고 해도 돌아올 때는 NAT을 통해서 a 값이 NAT에 의해서 값이 변경이 되기 때문에 이를 유의해서 진행을 해야한다.


포트포워딩 : static NAT 중에 특정 서비스만 NAT가 동작하도록 가능, 즉 외부에서 내부의 특정 서비스에 접속이 가능하도록 설정하는 것


내부로 나갈 때 dynamic(클라이언트는 많고 공인 ip가 적기 때문에 랜덤으로 정해짐. 일대일로 매칭이 불가능함.), 외부에서 들어올 때 static
바뀌어야할 IP주소를 ACL 표시. 즉 ACL로 NAT가 되어야할 트래픽 분류
access-list 1 permit 192.168.20.0 255.255.255.0 (standard는 출발지만)
access-list 101 permit ip 192.168.20.0 0.0.0.255 any (extend는 둘다 설정, 목적지는 any로 설정 가능)


만약 공인 ip를 2개 이상 사용을 한다면 공인 IP 주소 풀을 생성
ip nat pool TestPool 2.2.12.9 2.2.12.10 netmask 255.255.255.255

NAT 문을 작성
ip nat inside source list 1(or 101) interface s1/0(pool TestPool overload, 풀 사용시)
=> overload 는 Port Address Transition 으로 포트 번호까지 활용해서 IP 주소를 Transition 한다.


인터페이스 적용
int f0/0
ip nat inside

int s1/0
ip nat outside

NAT GATEWAY는 퍼블릭인 상태인 인스턴스를 통해서 설정을 해주어야 한다.
퍼블릭 서브넷에 있는 라우팅 테이블은 인터넷 게이트웨이를 설정을 해주고 프라이빗 서브넷에 있는 라우팅 테이블은 NAT 게이트웨이를 설정을 준다. (이를 해주는 이유는 내부 사설망에서 인터넷으로 접속을 하기 위함이다.)

NAT GATEWAY는 VPC별로 1개만 형성을 하면 된다.
